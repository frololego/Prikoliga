<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Регистрация</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"  rel="stylesheet">
    <link rel="stylesheet" href="/style.css">
</head>
<body class="bg-light">

<div class="container mt-5 mb-5">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card p-4 shadow-sm">
                <h3 class="card-title text-center mb-4">הרשמה</h3>

                <!-- Форма регистрации -->
                <form id="registerForm">
                    <div class="mb-3">
                        <label for="username" class="form-label">Имя пользователя</label>
                        <input type="text" class="form-control" id="username" required minlength="3" maxlength="20">
                    </div>

                    <div class="mb-3">
                        <label for="email" class="form-label">Email</label>
                        <input type="email" class="form-control" id="email" required>
                    </div>

                    <div class="mb-3">
                        <label for="password_hash" class="form-label">Пароль</label>
                        <input type="password_hash" class="form-control" id="password_hash" required minlength="6">
                    </div>

                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="termsCheckbox" required>
                        <label class="form-check-label" for="termsCheckbox">
                            Я принимаю <a href="/terms.html" target="_blank">пользовательское соглашение</a>
                        </label>
                    </div>

                    <div class="mb-3 form-check">
                         <input type="checkbox" class="form-check-input" id="privacyCheckbox" required>
                        <label class="form-check-label" for="privacyCheckbox">
                            Я ознакомился и принимаю <a href="/privacy-policy.html" target="_blank">политику конфиденциальности</a>
                        </label>
                    </div>

                    <button type="submit" class="btn btn-primary w-100">Зарегистрироваться</button>
                    <p class="mt-3 text-center">Уже есть аккаунт? <a href="/login.html">Войдите</a></p>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- JS для отправки формы -->
<script>
document.getElementById('registerForm').addEventListener('submit', async function (e) {
    e.preventDefault();

    const username = document.getElementById('username').value.trim();
    const email = document.getElementById('email').value.trim();
    const password_hash = document.getElementById('password_hash').value;
    const checkbox = document.getElementById('termsCheckbox');
    const privacyCheckbox = document.getElementById('privacyCheckbox');

    if (!username || !email || !password_hash) {
        alert("❌ Заполните все поля");
        return;
    }

    if (!checkbox.checked) {
        alert("❌ Вы должны принять пользовательское соглашение");
        return;
    }

    if (!privacyCheckbox.checked) {
        alert("❌ Примите политику конфиденциальности");
        return;
    }

    // === Отправляем данные на сервер ===
    const res = await fetch('/api/auth/register', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, email, password_hash })
    });

    const data = await res.json();

    if (res.ok) {
        localStorage.setItem('token', data.token);
        localStorage.setItem('username', data.username);
        window.location.href = '/profile.html';
    } else {
        alert("❌ Ошибка регистрации: " + (data.message || 'Неизвестная ошибка'));
    }
});
</script>

</body>
</html>